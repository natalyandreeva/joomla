var vmKeepAlive=function(){jQuery(function($){var lastUpd=0,kAlive=0,minlps=1,stopped=true;var sessMSec=60*1000*parseFloat(sessMin);var interval=(sessMSec-40000)*0.99;console.log('keepAlive each '+interval+' minutes and maxlps '+maxlps);var tKeepAlive=function($){if(stopped){kAlive=1;var loop=setInterval(function(){var newTime=new Date().getTime();if(kAlive>=minlps&&newTime-lastUpd>sessMSec*(parseFloat(maxlps)+0.99)){stopped=true;clearInterval(loop);}else{console.log('keep alive '+kAlive+' newTime '+((newTime-lastUpd)/60000)+' < '+(sessMin*(parseFloat(maxlps)+0.99)));kAlive++;$.ajax({url:vmAliveUrl,cache:false});}},interval);stopped=false;}};lastUpd=new Date().getTime();tKeepAlive($);$(document).on('keyup click','body',function(e){lastUpd=new Date().getTime();if(stopped){$.ajax({url:vmAliveUrl,cache:false});tKeepAlive($);}});});};vmKeepAlive();;